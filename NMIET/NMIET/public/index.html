<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Camouflage Detection System</title>
  <meta name="description" content="Simulated AI-powered camouflage detection demo with thermal overlay, capture, and backend logging." />
  <style>
    /* (styles mostly same as yours, slightly improved for accessibility/contrast) */
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial,Helvetica,sans-serif;background:linear-gradient(135deg,#000 0%,#280f3d 100%);color:#e6ffe6;min-height:100vh;padding:20px;}
    .container{max-width:1200px;margin:0 auto}
    .header{background:rgba(35, 42, 81, 0.75);padding:18px;border-radius:12px;text-align:center;margin-bottom:18px}
    h1{font-size:1.9rem;color:#06df06}
    p.lead{color:#76cb76;margin-top:6px}
    .main-grid{display:grid;grid-template-columns:1fr 420px;gap:18px}
    @media(max-width:980px){.main-grid{grid-template-columns:1fr}}
    .panel{background:rgba(10, 0, 52, 0.75);padding:14px;border-radius:12px}
    .video-container{position:relative;background:#000;border-radius:10px;overflow:hidden;height:320px}
    canvas.video-feed{width:100%;height:100%;display:block;object-fit:cover;background:#000}
    .detection-overlay{position:absolute;inset:0;pointer-events:none}
    .detection-box{position:absolute;border:3px solid #03fd03;background:rgba(154,255,154,0.06);border-radius:6px}
    .detection-label{position:absolute;top:-26px;left:0;background:#04fa04;color:#000;padding:3px 6px;border-radius:4px;font-weight:700;font-size:12px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button.btn{padding:9px 14px;border-radius:999px;border:0;cursor:pointer;font-weight:700;outline:none}
    .primary{background:#04f004;color:#000}
    .secondary{background:transparent;border:1px solid rgba(161, 154, 255, 0.12);color:#0ce20c}
    .status-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
    .status-card{background:rgba(0,64,0,0.35);padding:10px;border-radius:8px;text-align:center}
    .status-value{font-size:1.5rem;font-weight:800;color:#08e308}
    .settings .slider{width:100%}
    .log-panel{height:200px;overflow:auto;background:rgba(3, 0, 32, 0.9);padding:8px;border-radius:8px;margin-top:12px;font-family:monospace;font-size:12px;color:#08d708}
    .gallery{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .thumb{width:120px;height:80px;object-fit:cover;border-radius:6px;border:2px solid rgba(67, 3, 8, 0.06);cursor:pointer}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    /* alert animation */
    .alert-panel{margin-top:12px;padding:10px;border-radius:8px;background:rgba(75, 4, 4, 0.718);border:1px solid rgba(227, 44, 7, 0.937)}
    .alert-active{animation:pulse 1.2s infinite;border-color:#17ed17;background:rgba(154,255,154,0.12)}
    @keyframes pulse{0%{transform:scale(1);opacity:.8}50%{transform:scale(1.02);opacity:1}100%{transform:scale(1);opacity:.8}}
    label{display:block;margin-bottom:6px}
  </style>
  <!-- COCO-SSD and JSZip CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <div class="container" role="main">
    <header class="header" role="banner">
      <h1><P>üéØ Smart Camouflage Detection System</P></h1>
        <p class="lead"><b> AI-Powered Threat Detection (Simulated). Thermal & IR overlays, capture.</b></p>
    </header>
    <div class="main-grid">
      <section class="panel" aria-labelledby="live-heading">
        <h2 id="live-heading">üé• Live Detection Feed</h2>
        <div class="video-container" aria-live="polite" aria-label="Live camera feed">
          <canvas id="videoFeed" class="video-feed" width="640" height="320" role="img" aria-label="Camera output canvas"></canvas>
          <div id="detectionOverlay" class="detection-overlay" aria-hidden="true"></div>
        </div>
        <div class="controls" role="toolbar" aria-label="Controls">
          <button id="detectionToggleBtn" class="btn primary" aria-pressed="false">üöÄ Start Detection</button>
          <button id="thermalToggleBtn" class="btn secondary" aria-pressed="false">üå° Thermal Mode</button>
          <button id="captureBtn" class="btn secondary">üì∏ Capture</button>
          <button id="downloadAllBtn" class="btn secondary" title="Download all captures as zip">‚¨áÔ∏è Download All</button>
        </div>
        <div class="status-grid" aria-hidden="false" style="margin-top:12px">
          <div class="status-card" aria-live="polite"><div class="status-value" id="detectCount">0</div><div>Humans üë•</div></div>
          <div class="status-card" aria-live="polite"><div class="status-value" id="detectCount">0</div><div>Animals üêæ</div></div>
          <div class="status-card" aria-live="polite"><div class="status-value" id="detectCount">0</div><div>Vehicles üöó</div></div>
          <div class="status-card" aria-live="polite"><div class="status-value" id="confidence">0%</div><div>Confidence Level</div></div>
          <div class="status-card" aria-live="polite"><div class="status-value" id="fps">0</div><div>FPS</div></div>
        </div>
      </section>
<aside class="panel" aria-labelledby="controls-heading">
  <h2 id="controls-heading">‚öô System Controls & Logs</h2>

  <!-- Detection Settings -->
  <div class="settings" aria-label="Detection settings" style="margin-top:10px">
    <div class="slider-container">
      <label for="sensitivity">Detection Sensitivity: 
        <span id="sensitivityValue">75%</span>
      </label>
      <input id="sensitivity" class="slider" type="range" min="0" max="100" value="75" />
    </div>

    <div class="slider-container">
      <label for="thermal">Thermal Threshold: 
        <span id="thermalValue">60¬∞C</span>
      </label>
      <input id="thermal" class="slider" type="range" min="20" max="100" value="60" />
    </div>

    <div class="slider-container">
      <label for="radius">Alert Radius: 
        <span id="radiusValue">50m</span>
      </label>
      <input id="radius" class="slider" type="range" min="10" max="200" value="50" />
    </div>
  </div>

  <!-- Alert Panel -->
  <div id="alertPanel" class="alert-panel" role="status" aria-live="polite">
    <h4>üö® Alert System</h4>
    <p id="alertMessage">System monitoring... No threats detected</p>
    <div style="margin-top:8px">
      <button id="testAlertBtn" class="btn secondary">Test Alert</button>
    </div>
  </div>

  <!-- Log Panel -->
  <div class="log-panel" aria-live="polite" aria-atomic="false" aria-label="System log">
    <h4>üìù System Log</h4>
    <div id="logContainer" aria-hidden="false">
      <div class="log-entry log-info">[00:00:01] System initialized</div>
      <div class="log-entry log-info">[00:00:02] AI model loaded successfully</div>
      <div class="log-entry log-info">[00:00:03] Thermal sensors activated</div>
    </div>
  </div>

  <!-- Gallery -->
  <div style="margin-top:10px">
    <h3 style="margin-bottom:6px">Gallery</h3>
    <div id="gallery" class="gallery" aria-live="polite"></div>
  </div>
</aside>
    </div>
  </div>
  <div class="sr-only" id="sr-status">Ready</div>
  <audio id="buzzerSound" src="buzzer.mp3" preload="auto"></audio>
<script>
const canvas = document.getElementById('videoFeed');
const ctx = canvas.getContext('2d');
const overlay = document.getElementById('detectionOverlay');
const logContainer = document.getElementById('logContainer');
const gallery = document.getElementById('gallery');
const srStatus = document.getElementById('sr-status');
const detectionToggleBtn = document.getElementById('detectionToggleBtn');
const thermalToggleBtn = document.getElementById('thermalToggleBtn');
const captureBtn = document.getElementById('captureBtn');
const testAlertBtn = document.getElementById('testAlertBtn');
const downloadAllBtn = document.getElementById('downloadAllBtn');
const detectCountEl = document.getElementById('detectCount');
const confidenceEl = document.getElementById('confidence');
const fpsEl = document.getElementById('fps');
let detectionActive = false;
let thermalMode = false;
let lastFrameTime = performance.now();
let fps = 0;
const captures = [];
const video = document.createElement('video');
video.autoplay = true;
video.playsInline = true;
video.muted = true;
// Camera setup
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
    video.srcObject = stream;
    await video.play();
    logEvent("üì∑ Camera feed initialized", "info");
    requestAnimationFrame(drawCameraFeed);
  } catch (err) {
    alert("Camera error: " + err.message);
  }
}
startCamera();

// COCO-SSD
let model = null;
let detectionRunning = false;
cocoSsd.load().then(m => {
  model = m;
  logEvent("‚úÖ COCO-SSD model loaded", "info");
});

// Main loop
function drawCameraFeed() {
  const now = performance.now();
  const delta = Math.max(1, now - lastFrameTime);
  fps = Math.round(1000 / delta);
  lastFrameTime = now;
  fpsEl.textContent = fps;

  try {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  } catch (e) {}

  // thermal effect
  if (thermalMode) {
    const grad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 50, canvas.width/2, canvas.height/2, Math.max(canvas.width, canvas.height));
    grad.addColorStop(0, "rgba(154,255,154,0.12)");
    grad.addColorStop(1, "rgba(0,255,0,0.02)");
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  // run detection
  if (detectionActive && model && !detectionRunning) {
    detectionRunning = true;
    model.detect(video).then(predictions => {
      overlay.innerHTML = "";
      let people = [];
      predictions.forEach(pred => {
        if (pred.class === "person" && pred.score > 0.6) {
          people.push(pred);
          const [x, y, w, h] = pred.bbox;
          createDetectionBox(x, y, w, h, Math.round(pred.score * 100));
        }
      });
      if (people.length > 0) {
        detectCountEl.textContent = people.length;
        const avgConf = Math.round(people.reduce((sum, p) => sum + p.score, 0) / people.length * 100);
        confidenceEl.textContent = avgConf + "%";
        playBuzzer();
        logEvent(`üéØ ${people.length} person(s) detected (avg ${avgConf}%)`, "detection");
      } else {
        detectCountEl.textContent = "0";
        confidenceEl.textContent = "0%";
        stopBuzzer();
      }
      detectionRunning = false;
    });
  }
  requestAnimationFrame(drawCameraFeed);
}

// --- Helpers ---
function createDetectionBox(x, y, w, h, confidence) {
  const box = document.createElement("div");
  box.className = "detection-box";
  box.style.left = `${x}px`;
  box.style.top = `${y}px`;
  box.style.width = `${w}px`;
  box.style.height = `${h}px`;
  const label = document.createElement("div");
  label.className = "detection-label";
  label.textContent = `${confidence}%`;
  box.appendChild(label);
  overlay.appendChild(box);
}

function playBuzzer() {
  const buzzer = document.getElementById("buzzerSound");
  if (buzzer && buzzer.paused) buzzer.play().catch(()=>{});
}
function stopBuzzer() {
  const buzzer = document.getElementById("buzzerSound");
  if (buzzer && !buzzer.paused) buzzer.pause();
}

function logEvent(msg, type="info") {
  const time = new Date().toLocaleTimeString();
  const entry = document.createElement("div");
  entry.textContent = `[${time}] ${msg}`;
  logContainer.appendChild(entry);
  logContainer.scrollTop = logContainer.scrollHeight;
  srStatus.textContent = msg;
}

// --- Capture & Gallery ---
captureBtn.addEventListener("click", () => {
  // Create a new canvas for output
  const outCanvas = document.createElement("canvas");
  outCanvas.width = canvas.width;
  outCanvas.height = canvas.height;
  const outCtx = outCanvas.getContext("2d");
  // Draw video frame
  outCtx.drawImage(canvas, 0, 0);
  // Draw detection overlays
  Array.from(overlay.children).forEach(box => {
    const left = parseInt(box.style.left);
    const top = parseInt(box.style.top);
    const width = parseInt(box.style.width);
    const height = parseInt(box.style.height);
    outCtx.strokeStyle = "#9AFF9A";
    outCtx.lineWidth = 3;
    outCtx.strokeRect(left, top, width, height);
    // Draw label if present
    const label = box.querySelector(".detection-label");
    if (label) {
      outCtx.font = "bold 12px Arial";
      const text = label.textContent;
      const textWidth = outCtx.measureText(text).width;
      outCtx.fillStyle = "#9AFF9A";
      outCtx.fillRect(left, top-22, textWidth+12, 20);
      outCtx.fillStyle = "#000";
      outCtx.fillText(text, left+6, top-8);
    }
  });
  // Export PNG
  const dataUrl = outCanvas.toDataURL("image/png");
  addToGallery(dataUrl);
  logEvent("üì∏ Capture saved to gallery", "info");
  // Download immediately
  const a = document.createElement("a");
  a.href = dataUrl;
  a.download = `capture_${Date.now()}.png`;
  a.click();
});

function addToGallery(dataUrl) {
  captures.push(dataUrl);
  const img = document.createElement("img");
  img.src = dataUrl;
  img.className = "thumb";
  img.title = "Click to download";
  img.addEventListener("click", () => {
    const a = document.createElement("a");
    a.href = dataUrl;
    a.download = `capture_${Date.now()}.png`;
    a.click();
  });
  gallery.appendChild(img);
}

// --- Download All ---
downloadAllBtn.addEventListener("click", async () => {
  if (captures.length === 0) return;
  const zip = new JSZip();
  captures.forEach((dataUrl, i) => {
    const base64 = dataUrl.split(",")[1];
    zip.file(`capture_${i+1}.png`, base64, {base64: true});
  });
  const blob = await zip.generateAsync({type:"blob"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "captures.zip";
  a.click();
  logEvent("‚¨áÔ∏è All captures downloaded as ZIP", "info");
});

// --- Controls ---
detectionToggleBtn.addEventListener("click", () => {
  detectionActive = !detectionActive;
  detectionToggleBtn.textContent = detectionActive ? "‚è∏ Stop Detection" : "üöÄ Start Detection";
  logEvent(detectionActive ? "Detection started" : "Detection stopped");
});

thermalToggleBtn.addEventListener("click", () => {
  thermalMode = !thermalMode;
  thermalToggleBtn.textContent = thermalMode ? "üå° Thermal Mode (ON)" : "üå° Thermal Mode";
  logEvent(thermalMode ? "Thermal ON" : "Thermal OFF");
});
</script>
</body>
</html>